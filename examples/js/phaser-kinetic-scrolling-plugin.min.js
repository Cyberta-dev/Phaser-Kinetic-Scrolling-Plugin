(function(b){b.Plugin.KineticScrolling=function(a,e){b.Plugin.call(this,a,e);this.pressedDown=this.dragging=!1;this.targetY=this.targetX=this.callbackID=this.timestamp=0;this.autoScrollY=this.autoScrollX=!1;this.velocityWheelY=this.velocityWheelX=this.directionWheel=this.amplitudeY=this.amplitudeX=this.velocityY=this.velocityX=this.startY=this.startX=0;this.settings={kineticMovement:!0,timeConstantScroll:325,horizontalScroll:!0,verticalScroll:!1,horizontalWheel:!0,verticalWheel:!1,deltaWheel:40}};
b.Plugin.KineticScrolling.prototype=Object.create(b.Plugin.prototype);b.Plugin.KineticScrolling.prototype.constructor=b.Plugin.KineticScrolling;b.Plugin.KineticScrolling.prototype.configure=function(a){if(a)for(var b in a)this.settings.hasOwnProperty(b)&&(this.settings[b]=a[b])};b.Plugin.KineticScrolling.prototype.start=function(){this.game.input.onDown.add(this.beginMove,this);this.callbackID=this.game.input.addMoveCallback(this.moveCamera,this);this.game.input.onUp.add(this.endMove,this);this.game.input.mouse.mouseWheelCallback=
this.mouseWheel.bind(this)};b.Plugin.KineticScrolling.prototype.beginMove=function(){this.startX=this.game.input.x;this.startY=this.game.input.y;this.pressedDown=!0;this.timestamp=Date.now();this.velocityY=this.amplitudeY=this.velocityX=this.amplitudeX=0};b.Plugin.KineticScrolling.prototype.moveCamera=function(a,b,d){if(this.pressedDown){this.dragging=!1;this.now=Date.now();a=this.now-this.timestamp;this.timestamp=this.now;if(this.settings.horizontalScroll){var c=b-this.startX;0!==c&&(this.dragging=
!0);this.startX=b;this.velocityX=1E3*c/(1+a)*.8+.2*this.velocityX;this.game.camera.x-=c}this.settings.verticalScroll&&(c=d-this.startY,0!==c&&(this.dragging=!0),this.startY=d,this.velocityY=1E3*c/(1+a)*.8+.2*this.velocityY,this.game.camera.y-=c)}};b.Plugin.KineticScrolling.prototype.endMove=function(){this.autoScrollY=this.autoScrollX=this.pressedDown=!1;this.settings.kineticMovement&&(this.now=Date.now(),this.game.input.activePointer.withinGame&&(10<this.velocityX||-10>this.velocityX)&&(this.amplitudeX=
.8*this.velocityX,this.targetX=Math.round(this.game.camera.x-this.amplitudeX),this.autoScrollX=!0),this.game.input.activePointer.withinGame&&(10<this.velocityY||-10>this.velocityY)&&(this.amplitudeY=.8*this.velocityY,this.targetY=Math.round(this.game.camera.y-this.amplitudeY),this.autoScrollY=!0),this.game.input.activePointer.withinGame||(this.settings.horizontalScroll&&(this.autoScrollX=!0),this.settings.verticalScroll&&(this.autoScrollY=!0)))};b.Plugin.KineticScrolling.prototype.update=function(){this.elapsed=
Date.now()-this.timestamp;if(this.autoScrollX){var a=-this.amplitudeX*Math.exp(-this.elapsed/this.settings.timeConstantScroll);.5<a||-.5>a?this.game.camera.x=this.targetX-a:(this.autoScrollX=this.dragging=!1,this.game.camera.x=this.targetX)}this.autoScrollY&&(a=-this.amplitudeY*Math.exp(-this.elapsed/this.settings.timeConstantScroll),.5<a||-.5>a?this.game.camera.y=this.targetY-a:(this.autoScrollY=!1,this.game.camera.y=this.targetY,this.dragging=!1));this.settings.horizontalWheel&&(-.1>this.velocityWheelX||
.1<this.velocityWheelX||!this.game.input.activePointer.withinGame)&&(this.game.camera.x-=this.velocityWheelX,this.velocityWheelX*=.95);this.settings.verticalWheel&&(-.1>this.velocityWheelY||.1<this.velocityWheelY||!this.game.input.activePointer.withinGame)&&(this.game.camera.y-=this.velocityWheelY,this.velocityWheelY*=.95)};b.Plugin.KineticScrolling.prototype.mouseWheel=function(a){if(this.settings.horizontalWheel||this.settings.verticalWheel)a.preventDefault(),a=120*this.game.input.mouse.wheelDelta/
this.settings.deltaWheel,this.directionWheel!=this.game.input.mouse.wheelDelta&&(this.velocityWheelY=this.velocityWheelX=0,this.directionWheel=this.game.input.mouse.wheelDelta),this.settings.horizontalWheel&&(this.autoScrollX=!1,this.velocityWheelX+=a),this.settings.verticalWheel&&(this.autoScrollY=!1,this.velocityWheelY+=a)};b.Plugin.KineticScrolling.prototype.stop=function(){this.game.input.onDown.remove(this.beginMove,this);this.callbackID?this.game.input.deleteMoveCallback(this.callbackID):this.game.input.deleteMoveCallback(this.moveCamera,
this);this.game.input.onUp.remove(this.endMove,this);this.game.input.mouse.mouseWheelCallback=null}})(Phaser);