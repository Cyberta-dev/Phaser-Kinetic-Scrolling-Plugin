!function(i){"use strict";i.Plugin.KineticScrolling=function(t,e){i.Plugin.call(this,t,e),this.pointerId=null,this.dragging=!1,this.pressedDown=!1,this.timestamp=0,this.callbackID=0,this.targetX=0,this.targetY=0,this.autoScrollX=!1,this.autoScrollY=!1,this.startX=0,this.startY=0,this.velocityX=0,this.velocityY=0,this.amplitudeX=0,this.amplitudeY=0,this.directionWheel=0,this.velocityWheelX=0,this.velocityWheelY=0,this.thresholdOfTapTime=100,this.thresholdOfTapDistance=10,this.thresholdReached=!1,this.clickHelperActiveObjects=[],this.settings={kineticMovement:!0,timeConstantScroll:325,horizontalScroll:!0,verticalScroll:!1,horizontalWheel:!0,verticalWheel:!1,deltaWheel:40,onUpdate:null}},i.Plugin.KineticScrolling.prototype=Object.create(i.Plugin.prototype),i.Plugin.KineticScrolling.prototype.constructor=i.Plugin.KineticScrolling,i.Plugin.KineticScrolling.prototype.configure=function(i){if(i)for(var t in i)this.settings.hasOwnProperty(t)&&(this.settings[t]=i[t])},i.Plugin.KineticScrolling.prototype.start=function(){this.game.input.onDown.add(this.beginMove,this),this.callbackID=this.game.input.addMoveCallback(this.moveCamera,this),this.game.input.onUp.add(this.endMove,this),this.game.input.mouse.mouseWheelCallback=this.mouseWheel.bind(this)},i.Plugin.KineticScrolling.prototype.beginMove=function(i){this.pointerId=i.id,this.startX=this.game.input.x,this.startY=this.game.input.y,this.screenX=i.screenX,this.screenY=i.screenY,this.pressedDown=!0,this.thresholdReached=!1,this.timestamp=Date.now(),this.beginTime=this.timestamp,this.velocityY=this.amplitudeY=this.velocityX=this.amplitudeX=0},i.Plugin.KineticScrolling.prototype.moveCamera=function(i,t,e){if(clearTimeout(this.clearMovementTimer),this.pressedDown&&this.pointerId===i.id){this.now=Date.now();var s=this.now-this.timestamp;this.timestamp=this.now;var l=0,h=0;if(!(this.isTap()&&Math.abs(i.screenY-this.screenY)<this.thresholdOfTapDistance&&Math.abs(i.screenX-this.screenX)<this.thresholdOfTapDistance)){if(!this.thresholdReached)return this.thresholdReached=!0,this.startX=t,this.startY=e,void this.cancelClickEventHelpers();if(this.settings.horizontalScroll&&(l=t-this.startX,0!==l&&(this.dragging=!0),this.startX=t,this.velocityX=.8*(1e3*l/(1+s))+.2*this.velocityX,this.game.camera.x-=l),this.settings.verticalScroll&&(h=e-this.startY,0!==h&&(this.dragging=!0),this.startY=e,this.velocityY=.8*(1e3*h/(1+s))+.2*this.velocityY,this.game.camera.y-=h),"function"==typeof this.settings.onUpdate){var n=0;this.canCameraMoveX()&&(n=l);var c=0;this.canCameraMoveY()&&(c=h),this.settings.onUpdate(n,c)}this.clearMovementTimer=setTimeout(function(){this.velocityX=0,this.velocityY=0}.bind(this),20)}}},i.Plugin.KineticScrolling.prototype.isTap=function(){return this.now-this.beginTime<this.thresholdOfTapTime},i.Plugin.KineticScrolling.prototype.canCameraMoveX=function(){return this.game.camera.x>0&&this.game.camera.x+this.game.camera.width<this.game.camera.bounds.right},i.Plugin.KineticScrolling.prototype.canCameraMoveY=function(){return this.game.camera.y>0&&this.game.camera.y+this.game.camera.height<this.game.camera.bounds.height},i.Plugin.KineticScrolling.prototype.addClickEvents=function(i,t){if(i.kineticScrollingClickHelpers)for(var e in t)t.hasOwnProperty(e)&&(i.kineticScrollingClickHelpers[e]=t[e]);else i.kineticScrollingClickHelpers=t,i.inputEnabled=!0,i.kineticScrollingClickHelpers.inputIsDown=!1,i.events.onInputDown.add(function(){i.kineticScrollingClickHelpers.downTimer=setTimeout(function(){i.kineticScrollingClickHelpers.downTimer=null,this.thresholdReached||(this.clickHelperActiveObjects.push(i),i.kineticScrollingClickHelpers.inputIsDown=!0,i.kineticScrollingClickHelpers.down&&i.kineticScrollingClickHelpers.down(i))}.bind(this),this.thresholdOfTapTime+10)},this),i.events.onInputUp.add(function(){this.clickHelperActiveObjects.splice(this.clickHelperActiveObjects.indexOf(i)),i.kineticScrollingClickHelpers.inputIsDown?(i.kineticScrollingClickHelpers.up&&i.kineticScrollingClickHelpers.up(i),this.isTap()&&i.kineticScrollingClickHelpers.click&&i.kineticScrollingClickHelpers.click(i),i.kineticScrollingClickHelpers.inputIsDown=!1):i.kineticScrollingClickHelpers.downTimer&&!this.thresholdReached&&(clearTimeout(i.kineticScrollingClickHelpers.downTimer),i.kineticScrollingClickHelpers.down&&i.kineticScrollingClickHelpers.down(i),i.kineticScrollingClickHelpers.up&&i.kineticScrollingClickHelpers.up(i),i.kineticScrollingClickHelpers.click&&i.kineticScrollingClickHelpers.click(i))}.bind(this))},i.Plugin.KineticScrolling.prototype.cancelClickEventHelpers=function(){this.clickHelperActiveObjects.forEach(function(i){var t=i.kineticScrollingClickHelpers.inputIsDown;i.kineticScrollingClickHelpers.inputIsDown=!1,t&&i.kineticScrollingClickHelpers.up&&i.kineticScrollingClickHelpers.up()})},i.Plugin.KineticScrolling.prototype.endMove=function(){clearTimeout(this.clearMovementTimer),this.pointerId=null,this.pressedDown=!1,this.autoScrollX=!1,this.autoScrollY=!1,this.settings.kineticMovement&&(this.now=Date.now(),this.game.input.activePointer.withinGame&&((this.velocityX>10||this.velocityX<-10)&&(this.amplitudeX=.8*this.velocityX,this.targetX=Math.round(this.game.camera.x-this.amplitudeX),this.autoScrollX=!0),(this.velocityY>10||this.velocityY<-10)&&(this.amplitudeY=.8*this.velocityY,this.targetY=Math.round(this.game.camera.y-this.amplitudeY),this.autoScrollY=!0)),this.game.input.activePointer.withinGame||(this.velocityWheelXAbs=Math.abs(this.velocityWheelX),this.velocityWheelYAbs=Math.abs(this.velocityWheelY),this.settings.horizontalScroll&&(this.velocityWheelXAbs<.1||!this.game.input.activePointer.withinGame)&&(this.autoScrollX=!0),this.settings.verticalScroll&&(this.velocityWheelYAbs<.1||!this.game.input.activePointer.withinGame)&&(this.autoScrollY=!0)))},i.Plugin.KineticScrolling.prototype.update=function(){this.elapsed=Date.now()-this.timestamp,this.velocityWheelXAbs=Math.abs(this.velocityWheelX),this.velocityWheelYAbs=Math.abs(this.velocityWheelY);var i=0;this.autoScrollX&&0!=this.amplitudeX&&(i=-this.amplitudeX*Math.exp(-this.elapsed/this.settings.timeConstantScroll),this.canCameraMoveX()&&(i>.5||i<-.5)?this.game.camera.x=this.targetX-i:(this.autoScrollX=!1,this.game.camera.x=this.targetX)),this.autoScrollY&&0!=this.amplitudeY&&(i=-this.amplitudeY*Math.exp(-this.elapsed/this.settings.timeConstantScroll),this.canCameraMoveY()&&(i>.5||i<-.5)?this.game.camera.y=this.targetY-i:(this.autoScrollY=!1,this.game.camera.y=this.targetY)),this.autoScrollX||this.autoScrollY||(this.dragging=!1),this.settings.horizontalWheel&&this.velocityWheelXAbs>.1&&(this.dragging=!0,this.amplitudeX=0,this.autoScrollX=!1,this.game.camera.x-=this.velocityWheelX,this.velocityWheelX*=.95),this.settings.verticalWheel&&this.velocityWheelYAbs>.1&&(this.dragging=!0,this.autoScrollY=!1,this.game.camera.y-=this.velocityWheelY,this.velocityWheelY*=.95)},i.Plugin.KineticScrolling.prototype.mouseWheel=function(i){if(this.settings.horizontalWheel||this.settings.verticalWheel){i.preventDefault();var t=120*this.game.input.mouse.wheelDelta/this.settings.deltaWheel;if(this.directionWheel!=this.game.input.mouse.wheelDelta&&(this.velocityWheelX=0,this.velocityWheelY=0,this.directionWheel=this.game.input.mouse.wheelDelta),this.settings.horizontalWheel&&(this.autoScrollX=!1,this.velocityWheelX+=t,"function"==typeof this.settings.onUpdate)){var e=0;this.game.camera.x>0&&this.game.camera.x+this.game.camera.width<this.game.camera.bounds.width&&(e=t),this.settings.onUpdate(e,0)}if(this.settings.verticalWheel&&(this.autoScrollY=!1,this.velocityWheelY+=t,"function"==typeof this.settings.onUpdate)){var s=0;this.game.camera.y>0&&this.game.camera.y+this.game.camera.height<this.game.camera.bounds.height&&(s=t),this.settings.onUpdate(0,s)}}},i.Plugin.KineticScrolling.prototype.stop=function(){this.game.input.onDown.remove(this.beginMove,this),this.callbackID?this.game.input.deleteMoveCallback(this.callbackID):this.game.input.deleteMoveCallback(this.moveCamera,this),this.game.input.onUp.remove(this.endMove,this),this.game.input.mouse.mouseWheelCallback=null,this.clickHelperActiveObjects.length=0}}(Phaser);